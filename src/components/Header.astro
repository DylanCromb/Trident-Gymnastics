---
// Header component with centered logo and split navigation
import { readFileSync } from 'fs';
import { parse } from 'yaml';
import path from 'path';

// Load assets from CMS
let assets = { primary_logo: null };
try {
  const assetsPath = path.join(process.cwd(), 'content', 'assets.yml');
  const assetsFile = readFileSync(assetsPath, 'utf8');
  assets = parse(assetsFile);
} catch (error) {
  // Assets file doesn't exist or is empty, use defaults
}

// Determine logo URL
const primaryLogoUrl = assets.primary_logo ? `/uploads/${assets.primary_logo}` : '/images/logo.png';

// Get current page path for active link detection
const currentPath = Astro.url.pathname;

// Helper function to check if a link is active
function isActiveLink(href: string): boolean {
  if (href === '/') {
    return currentPath === '/';
  }
  return currentPath.startsWith(href);
}

// Check if Classes dropdown should be active
const classesPages = ['/juniorgym', '/edugym', '/urbangym', '/squad'];
const isClassesActive = classesPages.some(page => currentPath.startsWith(page));
---

<header class="site-header">
  <div class="logo-wrap">
    <a href="/" class="logo" aria-label="Trident Gymnastics Home">
      <img src={primaryLogoUrl} alt="Trident Gymnastics" />
    </a>
  </div>
  <nav class="main-nav" aria-label="Main">
    <ul>
      <li class="has-submenu">
        <button class={`nav-btn ${isClassesActive ? 'active' : ''}`}>
          Classes â–¾
        </button>
        <ul class="submenu">
          <li><a href="/juniorgym">JuniorGym</a></li>
          <li><a href="/edugym">EduGym</a></li>
          <li><a href="/urbangym">UrbanGym</a></li>
          <li><a href="/squad">Trident Squad</a></li>
        </ul>
      </li>
      <li><a href="/playgym" class={isActiveLink('/playgym') ? 'active' : ''}>PlayGym</a></li>
      <li><a href="/school-holidays" class={isActiveLink('/school-holidays') ? 'active' : ''}>Holiday Program</a></li>
      <li><a href="/parties" class={isActiveLink('/parties') ? 'active' : ''}>Birthday Parties</a></li>
      <li><a href="/dates" class={isActiveLink('/dates') ? 'active' : ''}>Dates</a></li>
      <li><a href="/about" class={isActiveLink('/about') ? 'active' : ''}>About</a></li>
      <li><a href="/contact" class={isActiveLink('/contact') ? 'active' : ''}>Customer Portal</a></li>
    </ul>
  </nav>
</header>

<script>
  // Dropdown functionality
  document.addEventListener('DOMContentLoaded', function() {
    const navBtn = document.querySelector('.nav-btn');
    const submenu = document.querySelector('.submenu');

    // Desktop dropdown
    if (navBtn && submenu) {
      navBtn.addEventListener('mouseenter', () => {
        submenu.style.display = 'block';
      });

      navBtn.addEventListener('mouseleave', () => {
        submenu.style.display = 'none';
      });

      // Keep dropdown open when hovering over it
      submenu.addEventListener('mouseenter', () => {
        submenu.style.display = 'block';
      });

      submenu.addEventListener('mouseleave', () => {
        submenu.style.display = 'none';
      });
    }
  });
</script>
