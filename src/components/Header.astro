---
// Header component with centered logo and split navigation
import { readFileSync } from 'fs';
import { parse } from 'yaml';
import path from 'path';

// Load assets from CMS
let assets = { primary_logo: null };
try {
  const assetsPath = path.join(process.cwd(), 'content', 'assets.yml');
  const assetsFile = readFileSync(assetsPath, 'utf8');
  assets = parse(assetsFile);
} catch (error) {
  // Assets file doesn't exist or is empty, use defaults
}

// Determine logo URL
const primaryLogoUrl = assets.primary_logo ? `/uploads/${assets.primary_logo}` : '/images/logo.png';

// Get current page path for active link detection
const currentPath = Astro.url.pathname;

// Helper function to check if a link is active
function isActiveLink(href: string): boolean {
  if (href === '/') {
    return currentPath === '/';
  }
  return currentPath.startsWith(href);
}

// Check if Classes dropdown should be active
const classesPages = ['/juniorgym', '/edugym', '/urbangym', '/agc'];
const isClassesActive = classesPages.some(page => currentPath.startsWith(page));
---

<header class="site-header">
  <div class="logo-row">
    <a href="/" class="logo" aria-label="Trident Gymnastics">
      <img src={primaryLogoUrl} alt="Trident Gymnastics" />
    </a>
  </div>

  <div class="nav-band">
    <nav class="main-nav" aria-label="Main">
      <ul class="nav-list">
        <li class="has-submenu">
          <button class={`nav-btn ${isClassesActive ? 'active' : ''}`} type="button" aria-expanded="false" aria-controls="nav-classes">
            Classes
          </button>
          <ul id="nav-classes" class="submenu" role="menu">
            <li role="none"><a role="menuitem" href="/juniorgym">JuniorGym</a></li>
            <li role="none"><a role="menuitem" href="/edugym">EduGym</a></li>
            <li role="none"><a role="menuitem" href="/urbangym">UrbanGym</a></li>
            <li role="none"><a role="menuitem" href="/agc">AGC</a></li>
          </ul>
        </li>
        <li><a href="/playgym" class={isActiveLink('/playgym') ? 'active' : ''}>PlayGym</a></li>
        <li><a href="/school-holidays" class={isActiveLink('/school-holidays') ? 'active' : ''}>Holiday Program</a></li>
        <li><a href="/parties" class={isActiveLink('/parties') ? 'active' : ''}>Birthday Parties</a></li>
        <li><a href="/dates" class={isActiveLink('/dates') ? 'active' : ''}>Dates</a></li>
        <li><a href="/about" class={isActiveLink('/about') ? 'active' : ''}>About</a></li>
        <li><a href="/contact" class={isActiveLink('/contact') ? 'active' : ''}>Customer Portal</a></li>
      </ul>
    </nav>
  </div>
</header>

<script>
  // Dropdown functionality
  document.addEventListener('DOMContentLoaded', function() {
    const navBtn = document.querySelector('.nav-btn');
    const submenu = document.querySelector('.submenu');

    // Desktop dropdown
    if (navBtn && submenu) {
      navBtn.addEventListener('mouseenter', () => {
        submenu.style.display = 'block';
      });

      navBtn.addEventListener('mouseleave', () => {
        submenu.style.display = 'none';
      });

      // Keep dropdown open when hovering over it
      submenu.addEventListener('mouseenter', () => {
        submenu.style.display = 'block';
      });

      submenu.addEventListener('mouseleave', () => {
        submenu.style.display = 'none';
      });
    }
  });
</script>
