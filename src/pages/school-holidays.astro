---
import Layout from '../layouts/Layout.astro';
import { readFileSync } from 'fs';
import { parse } from 'yaml';
import path from 'path';

// Read and parse the holidays YAML file
const holidaysPath = path.join(process.cwd(), 'content', 'holidays.yml');
const holidaysFile = readFileSync(holidaysPath, 'utf8');
const holidaysData = parse(holidaysFile);

// Sort holidays by start date (most recent first)
const sortedHolidays = holidaysData.holidays.sort((a: any, b: any) => 
  new Date(b.start).getTime() - new Date(a.start).getTime()
);

// Format date for display
function formatDate(dateString: string): string {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-AU', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

// Get current date for highlighting
const today = new Date();

// Helper function to check if holiday is current or upcoming
function getHolidayStatus(holiday: any) {
  const holidayStart = new Date(holiday.start);
  const holidayEnd = new Date(holiday.end);
  const todayTime = today.getTime();
  const startTime = holidayStart.getTime();
  const endTime = holidayEnd.getTime();
  
  return {
    isCurrent: startTime <= todayTime && endTime >= todayTime,
    isUpcoming: startTime > todayTime
  };
}
---

<Layout title="School Holidays" description="School holiday programs and schedules at Trident Gymnastics.">
  <main>
    <section class="page-header">
      <div class="container">
        <h1>School Holiday Programs</h1>
        <p>Fun and engaging gymnastics programs during school holidays</p>
      </div>
    </section>

    <section class="content">
      <div class="container">
        <div class="holidays-intro">
          <h2>Holiday Programs</h2>
          <p>Keep your children active and engaged during school holidays with our exciting gymnastics programs. Each holiday period offers unique activities designed for different age groups and skill levels.</p>
        </div>

        <div class="holidays-grid">
          {sortedHolidays.map((holiday: any) => {
            const status = getHolidayStatus(holiday);
            
            return (
              <div class={`holiday-card ${status.isCurrent ? 'current' : ''} ${status.isUpcoming ? 'upcoming' : ''}`}>
                <div class="holiday-header">
                  <div class="season-badge season-{holiday.season.toLowerCase()}">
                    {holiday.season}
                  </div>
                  <h3>{holiday.term_year}</h3>
                </div>
                
                <div class="holiday-dates">
                  <div class="date-range">
                    <span class="date-label">Start:</span>
                    <span class="date-value">{formatDate(holiday.start)}</span>
                  </div>
                  <div class="date-range">
                    <span class="date-label">End:</span>
                    <span class="date-value">{formatDate(holiday.end)}</span>
                  </div>
                </div>

                <div class="operating-rules">
                  <h4>Operating Information</h4>
                  <p>{holiday.operating_rules}</p>
                </div>

                <div class="programs">
                  <h4>Available Programs</h4>
                  <div class="programs-list">
                    {holiday.programs.map((program: any) => (
                      <div class="program-card">
                        <div class="program-info">
                          <h5>{program.name}</h5>
                          <p class="program-blurb">{program.blurb}</p>
                          <span class="program-age">{program.age}</span>
                        </div>
                        <a 
                          href={program.book_url} 
                          class="book-btn"
                          target="_blank"
                          rel="noopener noreferrer"
                        >
                          Book Now
                        </a>
                      </div>
                    ))}
                  </div>
                </div>

                <div class="last-updated">
                  <small>Last updated: {formatDate(holiday.last_updated)}</small>
                </div>
              </div>
            );
          })}
        </div>

        <div class="cta-section">
          <h2>Questions About Holiday Programs?</h2>
          <p>Contact us for more information about our holiday programs or to discuss which program is right for your child.</p>
          <a href="/contact" class="btn btn-primary">Contact Us</a>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  .page-header {
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    color: var(--color-white);
    padding: 3rem 0;
    text-align: center;
  }

  .page-header h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    color: var(--color-white) !important;
  }

  .content {
    padding: 4rem 0;
  }

  .holidays-intro {
    text-align: center;
    margin-bottom: 3rem;
  }

  .holidays-intro h2 {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: var(--text-color);
  }

  .holidays-intro p {
    font-size: 1.1rem;
    color: var(--text-light);
    max-width: 600px;
    margin: 0 auto;
  }

  .holidays-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .holiday-card {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--border-color);
    padding: 2rem;
    transition: all 0.3s ease;
  }

  .holiday-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
  }

  .holiday-card.current {
    border-left: 4px solid var(--color-accent);
  }

  .holiday-card.upcoming {
    border-left: 4px solid var(--color-primary);
  }

  .holiday-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .season-badge {
    padding: 0.5rem 1rem;
    border-radius: 1rem;
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .season-summer {
    background: var(--color-accent);
    color: #141414;
  }

  .season-autumn {
    background: var(--color-primary);
    color: var(--color-white);
  }

  .season-winter {
    background: var(--color-secondary);
    color: var(--color-white);
  }

  .season-spring {
    background: var(--color-primary);
    color: var(--color-white);
  }

  .holiday-header h3 {
    color: var(--text-color);
    font-size: 1.5rem;
    margin: 0;
  }

  .holiday-dates {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: var(--bg-light);
    border-radius: 0.5rem;
  }

  .date-range {
    display: flex;
    flex-direction: column;
  }

  .date-label {
    font-size: 0.9rem;
    color: var(--text-light);
    font-weight: 500;
  }

  .date-value {
    font-weight: 600;
    color: var(--text-color);
  }

  .operating-rules {
    margin-bottom: 1.5rem;
  }

  .operating-rules h4 {
    color: var(--text-color);
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
  }

  .operating-rules p {
    color: var(--text-light);
    font-size: 0.95rem;
    line-height: 1.5;
  }

  .programs h4 {
    color: var(--text-color);
    margin-bottom: 1rem;
    font-size: 1.1rem;
  }

  .programs-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .program-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: var(--bg-light);
    border-radius: 0.5rem;
    border: 1px solid var(--border-color);
  }

  .program-info h5 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    font-size: 1rem;
  }

  .program-blurb {
    color: var(--text-light);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    line-height: 1.4;
  }

  .program-age {
    background: var(--primary-color);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .book-btn {
    background: var(--accent-color);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    white-space: nowrap;
  }

  .book-btn:hover {
    background: var(--color-primary);
    transform: translateY(-2px);
  }

  .last-updated {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
    text-align: center;
  }

  .last-updated small {
    color: var(--text-light);
    font-size: 0.8rem;
  }

  .cta-section {
    text-align: center;
    background: var(--bg-light);
    padding: 3rem;
    border-radius: 1rem;
  }

  .cta-section h2 {
    margin-bottom: 1rem;
    color: var(--text-color);
  }

  .cta-section p {
    margin-bottom: 2rem;
    color: var(--text-light);
  }

  .btn {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-primary {
    background: var(--accent-color);
    color: white;
  }

  .btn-primary:hover {
    background: var(--color-primary);
    transform: translateY(-2px);
  }

  @media (max-width: 768px) {
    .holidays-grid {
      grid-template-columns: 1fr;
    }

    .holiday-dates {
      grid-template-columns: 1fr;
    }

    .program-card {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }

    .book-btn {
      width: 100%;
    }
  }
</style>
